<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SRP Pro | Fixed</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>
    <style>
        body { font-family: sans-serif; background: #f4f4f4; margin: 0; padding-bottom: 60px; }
        header { background: #131921; color: white; padding: 15px; display: flex; justify-content: space-between; }
        .card { background: white; margin: 10px; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        input, button { width: 100%; padding: 12px; margin: 5px 0; border-radius: 4px; border: 1px solid #ccc; box-sizing: border-box; }
        .btn { background: #febd69; border: 1px solid #a88734; font-weight: bold; cursor: pointer; }
        .hidden { display: none; }
        nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; border-top: 1px solid #ddd; }
        .nav-link { flex: 1; text-align: center; padding: 10px; cursor: pointer; }
    </style>
</head>
<body>

<div id="app" class="hidden">
    <header>
        <b onclick="checkAdmin()">SRP.in</b>
        <span id="bal">₹0</span>
    </header>

    <div id="home" class="sec card">
        <h3>Products</h3>
        <div id="list" style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;"></div>
    </div>

    <div id="admin" class="sec card hidden">
        <h3>Admin Panel</h3>
        <input id="n" placeholder="Product Name">
        <input id="p" type="number" placeholder="Price">
        <input type="file" id="f">
        <div id="st" style="color: blue; font-weight: bold; margin: 5px 0;">Status: Waiting</div>
        <button class="btn" id="upBtn" onclick="upload()">Upload & Save</button>
        <hr>
        <h4>Change PIN</h4>
        <input type="password" id="newPin" placeholder="New PIN">
        <button onclick="savePin()">Update PIN</button>
    </div>

    <nav>
        <div class="nav-link" onclick="sh('home')">Home</div>
        <div class="nav-link" onclick="sh('admin')">Admin</div>
    </nav>
</div>

<div id="login" style="text-align:center; margin-top:100px;">
    <h2>SRP.in</h2>
    <button class="btn" style="width:200px;" onclick="googleLogin()">Login with Google</button>
</div>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyCHyu_nVnU-ewwXkpYOPqhwN64WPV7J6UM",
    authDomain: "srp-sketch.firebaseapp.com",
    databaseURL: "https://srp-sketch-default-rtdb.firebaseio.com",
    projectId: "srp-sketch",
    storageBucket: "srp-sketch.appspot.com"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth(), db = firebase.database(), st = firebase.storage();

function googleLogin() { auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); }

auth.onAuthStateChanged(user => {
    if(user) {
        document.getElementById('login').classList.add('hidden');
        document.getElementById('app').classList.remove('hidden');
        load();
    }
});

async function upload() {
    const file = document.getElementById('f').files[0];
    const status = document.getElementById('st');
    const btn = document.getElementById('upBtn');
    if(!file) return alert("Select file!");

    btn.disabled = true;
    status.innerText = "UPLOADING...";

    try {
        const ref = st.ref().child('items/' + Date.now() + "_" + file.name);
        const snap = await ref.put(file);
        const url = await snap.ref.getDownloadURL();
        
        await db.ref('products').push({
            name: document.getElementById('n').value,
            price: document.getElementById('p').value,
            img: url
        });

        alert("Success!");
        location.reload();
    } catch (e) {
        alert("Error: " + e.message);
        btn.disabled = false;
        status.innerText = "FAILED";
    }
}

function load() {
    db.ref('products').on('value', s => {
        const div = document.getElementById('list'); div.innerHTML = "";
        s.forEach(p => {
            const v = p.val();
            div.innerHTML += `<div class="card" style="margin:0;"><img src="${v.img}" width="100%"><br><b>${v.name}</b><br>₹${v.price}</div>`;
        });
    });
}

function savePin() {
    const p = document.getElementById('newPin').value;
    if(p) db.ref('store/pin').set(p).then(() => alert("PIN Saved"));
}

function checkAdmin() {
    db.ref('store/pin').once('value', s => {
        const pin = s.val() || "406";
        if(prompt("Enter PIN:") === pin) sh('admin');
    });
}

function sh(id) {
    document.querySelectorAll('.sec').forEach(s => s.classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');
}
</script>
</body>
</html>
