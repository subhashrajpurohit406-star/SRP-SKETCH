<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SRP SHOPPING | Pro</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        :root { --amz-navy: #232f3e; --amz-orange: #febd69; --amz-yellow: #ffd814; --bg: #f3f3f3; }
        body { margin: 0; font-family: 'Amazon Ember', Arial, sans-serif; background: var(--bg); color: #111; padding-bottom: 70px; }
        
        /* HEADER & MENU */
        header { background: var(--amz-navy); padding: 12px 15px; display: flex; align-items: center; position: sticky; top: 0; z-index: 1000; }
        .menu-dots { font-size: 24px; color: #fff; cursor: pointer; margin-right: 15px; }
        .logo { color: #fff; font-size: 18px; font-weight: bold; flex-grow: 1; }
        .logo span { color: var(--amz-orange); }

        /* SEARCH BAR */
        .search-row { background: var(--amz-navy); padding: 0 10px 10px 10px; }
        .search-bar { background: #fff; display: flex; border-radius: 4px; overflow: hidden; height: 40px; }
        .search-bar input { flex: 1; border: none; padding: 0 10px; outline: none; }
        .search-btn { background: var(--amz-orange); border: none; width: 45px; }

        /* SECTIONS */
        .page { display: none; padding: 15px; animation: fadeIn 0.3s ease; }
        .active { display: block !important; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* AMAZON PRODUCT CARDS */
        .p-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .p-card { background: #fff; border-radius: 4px; padding: 10px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); display: flex; flex-direction: column; }
        .p-card img { width: 100%; height: 140px; object-fit: contain; }
        .p-title { font-size: 14px; margin: 8px 0; height: 35px; overflow: hidden; }
        .p-price { font-size: 18px; font-weight: bold; }
        .p-mrp { font-size: 12px; text-decoration: line-through; color: #565959; }

        /* BUTTONS */
        .btn-amz { background: var(--amz-yellow); border: 1px solid #a88734; border-radius: 20px; padding: 10px; width: 100%; font-weight: bold; cursor: pointer; margin-top: 5px; }
        .btn-p { background: var(--amz-orange); }

        /* BOTTOM NAV */
        nav { position: fixed; bottom: 0; width: 100%; background: #fff; display: flex; justify-content: space-around; padding: 10px 0; border-top: 1px solid #ddd; z-index: 5000; }
        .nav-item { text-align: center; font-size: 11px; color: #555; cursor: pointer; }
        .nav-item.active-nav { color: #e77600; font-weight: bold; }

        /* ACCOUNT MANAGER */
        .acc-box { background: #fff; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #ddd; }
        .acc-pill { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #eee; font-size: 14px; }
        
        /* OVERLAYS */
        #payment-overlay { position: fixed; inset: 0; background: #fff; z-index: 9999; display: none; padding: 20px; text-align: center; }
        #auth-screen { position: fixed; inset: 0; background: #fff; z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    </style>
</head>
<body>

<div id="auth-screen">
    <div style="font-size: 30px; font-weight: bold; margin-bottom: 30px;">SRP SHOPPING</div>
    <div style="width: 85%; max-width: 350px; border: 1px solid #ddd; padding: 20px; border-radius: 8px;">
        <h2>Sign-In</h2>
        <button class="btn-amz" style="background:#fff; border:1px solid #888; display:flex; align-items:center; justify-content:center; gap:10px;" onclick="googleSignIn()">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/action/google.svg" width="18"> Google Account
        </button>
        <div style="margin: 20px 0; text-align: center; color: #777;">OR</div>
        <input type="email" id="u-email" placeholder="Email / Mobile">
        <input type="password" id="u-pass" placeholder="Password">
        <button class="btn-amz" onclick="emailSignIn()">Continue</button>
    </div>
</div>

<header id="main-header" style="display:none">
    <div class="menu-dots" onclick="openAdmin()">‚ãÆ</div>
    <div class="logo">srp-shopping<span>.in</span></div>
    <div style="color:#fff; font-size:12px;" onclick="showPage('you')">Hello, <span id="user-name">User</span></div>
</header>
<div class="search-row" id="search-row" style="display:none">
    <div class="search-bar">
        <input type="text" id="p-search" placeholder="Search products..." onkeyup="doSearch()">
        <button class="search-btn">üîç</button>
    </div>
</div>

<div id="home-page" class="page active">
    <div class="p-grid" id="product-list"></div>
</div>

<div id="ai-page" class="page">
    <h3>ü§ñ Rishi Assistant</h3>
    <div id="chat-box" style="height:300px; background:#fff; overflow-y:auto; padding:10px; border-radius:5px; border:1px solid #ddd; margin-bottom:10px;"></div>
    <div style="display:flex; gap:5px;">
        <input type="text" id="ai-input" placeholder="Ask Rishi..." style="margin:0;">
        <button class="btn-amz" style="width:80px; margin:0;" onclick="askRishi()">Ask</button>
    </div>
</div>

<div id="wallet-page" class="page">
    <div style="background:var(--amz-navy); color:#fff; padding:40px; border-radius:15px; text-align:center;">
        <p>Current Balance</p>
        <h1 id="wall-val">‚Çπ0.00</h1>
    </div>
    <input type="number" id="add-val" placeholder="Amount to add (‚Çπ)">
    <button class="btn-amz btn-p" onclick="initAdd()">Add to Wallet via UPI</button>
</div>

<div id="you-page" class="page">
    <div class="acc-box">
        <h3>Manage Accounts (Max 3)</h3>
        <div id="account-list"></div>
        <button class="btn-amz" onclick="firebase.auth().signOut()">+ Add / Switch Account</button>
    </div>
    <div class="acc-box">
        <div onclick="showLegal('about')">‚ÑπÔ∏è About Us <button onclick="event.stopPropagation(); editLegal('about')">Edit</button></div>
        <hr>
        <div onclick="showLegal('privacy')">üõ°Ô∏è Privacy Policy <button onclick="event.stopPropagation(); editLegal('privacy')">Edit</button></div>
        <div id="legal-content" style="display:none; margin-top:10px; font-size:13px; color:#555;"></div>
    </div>
</div>

<div id="admin-page" class="page">
    <button class="btn-amz" onclick="showPage('home')">Back to Store</button>
    <div class="acc-box">
        <h3>Add New Product</h3>
        <input type="text" id="adm-name" placeholder="Product Name">
        <input type="number" id="adm-mrp" placeholder="MRP Price">
        <input type="number" id="adm-price" placeholder="Sale Price">
        <input type="file" id="adm-img" accept="image/*">
        <button class="btn-amz btn-p" id="pub-btn" onclick="publish()">Publish Item</button>
    </div>
    <div class="acc-box">
        <h3>Order Logs & Status</h3>
        <div id="admin-orders"></div>
    </div>
</div>

<div id="payment-overlay">
    <h2 id="pay-title">Finalize Order</h2>
    <div id="checkout-form">
        <input type="text" id="c-name" placeholder="Full Name">
        <input type="text" id="c-phone" placeholder="Mobile Number">
        <input type="text" id="c-email" placeholder="Email ID">
        <input type="text" id="c-pin" placeholder="Pincode">
        <textarea id="c-addr" placeholder="Full Delivery Address"></textarea>
        <button class="btn-amz btn-p" onclick="submitOrder()">Proceed to Payment</button>
    </div>
    <div id="upi-step" style="display:none;">
        <p>Total Payable: <b id="pay-amt"></b></p>
        <div id="qr-code"></div>
        <p>UPI ID: <b>subhashrajpurohit406@oksbi</b></p>
        <button class="btn-amz btn-p" onclick="completePay()">I Have Paid</button>
    </div>
    <button class="btn-amz" style="background:#eee; margin-top:10px;" onclick="closePay()">Cancel</button>
</div>

<nav id="bottom-nav" style="display:none">
    <div class="nav-item active-nav" onclick="showPage('home')">üè†<br>Home</div>
    <div class="nav-item" onclick="showPage('ai')">ü§ñ<br>Rishi AI</div>
    <div class="nav-item" onclick="showPage('wallet')">üí≥<br>Wallet</div>
    <div class="nav-item" onclick="showPage('you')">üë§<br>You</div>
</nav>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAJ4VEkLsy4-S8ypn59rTi6_Y4o1kA2H2Q",
  authDomain: "srp-shopping.firebaseapp.com",
  databaseURL: "https://srp-shopping-default-rtdb.firebaseio.com",
  projectId: "srp-shopping",
  storageBucket: "srp-shopping.firebasestorage.app",
  messagingSenderId: "248909661130",
  appId: "1:248909661130:web:5d31e0b17fc3848d588533"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

auth.onAuthStateChanged(user => {
    if(user) {
        document.getElementById('auth-screen').style.display = 'none';
        document.getElementById('main-header').style.display = 'flex';
        document.getElementById('search-row').style.display = 'block';
        document.getElementById('bottom-nav').style.display = 'flex';
        document.getElementById('user-name').innerText = user.displayName || user.email.split('@')[0];
        manageAccounts(user.email);
        initSync(user.uid);
    } else {
        document.getElementById('auth-screen').style.display = 'flex';
    }
});

function googleSignIn() { auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); }
function emailSignIn() { 
    const e = document.getElementById('u-email').value;
    const p = document.getElementById('u-pass').value;
    auth.signInWithEmailAndPassword(e, p).catch(err => alert(err.message));
}

function manageAccounts(email) {
    let list = JSON.parse(localStorage.getItem('srp_accs')) || [];
    if(!list.includes(email)) {
        if(list.length >= 3) list.shift();
        list.push(email);
    }
    localStorage.setItem('srp_accs', JSON.stringify(list));
    renderAccounts();
}

function renderAccounts() {
    const list = JSON.parse(localStorage.getItem('srp_accs')) || [];
    const div = document.getElementById('account-list');
    div.innerHTML = "";
    list.forEach(acc => {
        div.innerHTML += `<div class="acc-pill"><span>${acc}</span> <button onclick="switchAcc('${acc}')">Switch</button></div>`;
    });
}

function initSync(uid) {
    db.ref('products').on('value', snap => {
        const list = document.getElementById('product-list');
        list.innerHTML = "";
        snap.forEach(p => {
            const d = p.val();
            list.innerHTML += `<div class="p-card">
                <img src="${d.img}">
                <div class="p-title">${d.name}</div>
                <div class="p-price">‚Çπ${d.price} <span class="p-mrp">‚Çπ${d.mrp}</span></div>
                <button class="btn-amz btn-p" onclick="buy('${p.key}','${d.price}')">Buy Now</button>
                <button class="btn-amz" onclick="alert('Added to cart')">Add to Cart</button>
            </div>`;
        });
    });
    db.ref('wallets/' + uid).on('value', s => {
        document.getElementById('wall-val').innerText = "‚Çπ" + (s.val() || 0);
    });
}

function buy(id, price) {
    window.currentBuy = { id, price };
    document.getElementById('payment-overlay').style.display = 'block';
    document.getElementById('pay-amt').innerText = "‚Çπ" + price;
}

function submitOrder() {
    const data = {
        name: document.getElementById('c-name').value,
        phone: document.getElementById('c-phone').value,
        email: document.getElementById('c-email').value,
        pin: document.getElementById('c-pin').value,
        addr: document.getElementById('c-addr').value
    };
    if(!data.name || !data.phone || !data.pin) return alert("Fill all details!");
    
    document.getElementById('checkout-form').style.display = 'none';
    document.getElementById('upi-step').style.display = 'block';
    const qr = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=upi://pay?pa=subhashrajpurohit406@oksbi&am=${window.currentBuy.price}`;
    document.getElementById('qr-code').innerHTML = `<img src="${qr}">`;
}

function completePay() {
    db.ref('orders').push({
        uid: auth.currentUser.uid,
        product: window.currentBuy.id,
        price: window.currentBuy.price,
        status: "Payment Processing",
        time: Date.now()
    });
    alert("Payment submitted! Admin will verify soon.");
    closePay();
}

function openAdmin() { if(prompt("Pass:") === "406") { showPage('admin'); renderAdminLogs(); } }

function publish() {
    const name = document.getElementById('adm-name').value;
    const mrp = document.getElementById('adm-mrp').value;
    const price = document.getElementById('adm-price').value;
    const file = document.getElementById('adm-img').files[0];
    const reader = new FileReader();
    reader.onload = (e) => {
        db.ref('products').push({ name, mrp, price, img: e.target.result });
        alert("Published!");
    };
    reader.readAsDataURL(file);
}

function renderAdminLogs() {
    db.ref('orders').on('value', s => {
        const div = document.getElementById('admin-orders');
        div.innerHTML = "";
        s.forEach(o => {
            const v = o.val();
            div.innerHTML += `<div class="acc-box" style="font-size:12px;">
                <b>ID:</b> ${o.key}<br><b>Price:</b> ‚Çπ${v.price}<br>
                <b>Status:</b> ${v.status} 
                <button onclick="db.ref('orders/${o.key}').update({status:'Confirmed'})">Confirm</button>
            </div>`;
        });
    });
}

function askRishi() {
    const q = document.getElementById('ai-input').value.toLowerCase();
    const box = document.getElementById('chat-box');
    let res = "I am Rishi. I can help with payments and orders. For UPI payment, use ID: subhashrajpurohit406@oksbi.";
    if(q.includes("wallet")) res = "To add money, go to the Wallet section and pay via UPI.";
    box.innerHTML += `<div><b>You:</b> ${q}</div><div><b>Rishi:</b> ${res}</div>`;
}

function showPage(id) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(id + '-page').classList.add('active');
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active-nav'));
}

function editLegal(type) { 
    if(auth.currentUser.uid === 'YOUR_ADMIN_UID') {
        const val = prompt("Enter new text for " + type);
        db.ref('legal/' + type).set(val);
    } else { alert("Admins Only"); }
}

function closePay() {
    document.getElementById('payment-overlay').style.display = 'none';
    document.getElementById('checkout-form').style.display = 'block';
    document.getElementById('upi-step').style.display = 'none';
}
</script>
</body>
</html>
