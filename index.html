<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SRP SKETCH | Professional</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
    <style>
        :root { --amz-orange: #febd69; --amz-dark: #232f3e; --bg: #131921; --card: #ffffff; --text: #111; }
        body { margin: 0; font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); color: #fff; padding-bottom: 80px; }
        
        /* 1. SECURE LOGIN GATE (Real Database) */
        #auth-gate { position: fixed; inset: 0; background: #fff; color: #111; z-index: 9999; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .auth-box { width: 100%; max-width: 350px; border: 1px solid #ddd; padding: 25px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        
        /* 2. APP UI */
        #main-app { display: none; }
        .page { display: none; padding: 15px; animation: fadeIn 0.3s ease; }
        .active-page { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        header { background: #232f3e; padding: 15px; position: sticky; top: 0; z-index: 1000; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--amz-orange); }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        
        /* Product Cards */
        .item { background: #fff; color: #111; padding: 10px; border-radius: 5px; position: relative; }
        .item img { width: 100%; height: 160px; object-fit: cover; border-radius: 3px; }
        .oos { opacity: 0.5; filter: grayscale(1); }
        .oos-tag { position: absolute; top: 5px; left: 5px; background: red; color: white; padding: 2px 6px; font-size: 10px; font-weight: bold; }

        /* Buttons & Inputs */
        .btn { width: 100%; padding: 12px; border-radius: 25px; border: none; font-weight: bold; cursor: pointer; margin-top: 8px; }
        .btn-p { background: #ffa41c; border: 1px solid #ff8f00; }
        .btn-s { background: #ffd814; border: 1px solid #fcd200; }
        input, textarea { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #a6a6a6; border-radius: 3px; box-sizing: border-box; }

        /* Nav */
        .nav { position: fixed; bottom: 0; width: 100%; background: #232f3e; display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid #3a4553; }
        .nav-link { text-align: center; font-size: 11px; color: #ccc; cursor: pointer; }
        .nav-link.active { color: var(--amz-orange); font-weight: bold; }

        /* Rishi Chat */
        #r-chat { height: 300px; background: #000; padding: 15px; overflow-y: auto; border-radius: 8px; margin-bottom: 10px; }
        .msg { margin-bottom: 10px; padding: 8px; border-radius: 5px; font-size: 14px; }
        .r-msg { background: #37475a; color: #fff; margin-right: 20%; }
        .u-msg { background: var(--amz-orange); color: #000; margin-left: 20%; text-align: right; }
    </style>
</head>
<body>

<div id="auth-gate">
    <div class="auth-box">
        <center><h2>SRP SKETCH</h2></center>
        <p>Login to your Google/Email Account</p>
        <input type="email" id="a-email" placeholder="Email Address">
        <input type="password" id="a-pass" placeholder="Password">
        <button class="btn btn-p" onclick="login()">Sign In</button>
        <p style="font-size:11px; color: #888; text-align: center;">We save your login details securely in the database.</p>
    </div>
</div>

<div id="main-app">
    <header>
        <div style="color: var(--amz-orange); font-weight: bold;">SRP SKETCH</div>
        <div id="user-info" style="font-size: 11px;"></div>
    </header>

    <div id="home-p" class="page active-page">
        <div class="grid" id="product-list"></div>
    </div>

    <div id="rishi-p" class="page">
        <h3>ü§ñ Rishi Smart Assistant</h3>
        <div id="r-chat"></div>
        <div style="display:flex; gap:5px;">
            <input type="text" id="r-input" placeholder="Ask Rishi..." style="margin:0;">
            <button class="btn btn-p" style="width:70px; margin:0;" onclick="askRishi()">Ask</button>
        </div>
    </div>

    <div id="wallet-p" class="page">
        <h3>My Wallet</h3>
        <div style="background: #232f3e; padding: 40px; border-radius: 10px; text-align: center;">
            <h1 id="w-bal">‚Çπ0.00</h1>
            <button class="btn btn-s" onclick="addMoney()">Add Money via UPI</button>
        </div>
    </div>

    <div id="you-p" class="page">
        <h3>My Account</h3>
        <div style="background:#fff; color:#111; border-radius:8px;">
            <div style="padding:15px; border-bottom:1px solid #eee;" onclick="showOrders()">üì¶ My Orders</div>
            <div style="padding:15px; border-bottom:1px solid #eee;" onclick="manageAccounts()">üë• Manage Account (Switch)</div>
            <div style="padding:15px; border-bottom:1px solid #eee;" onclick="showAbout()">‚ÑπÔ∏è About Us</div>
            <div style="padding:15px; color:red;" onclick="logout()">üö™ Logout</div>
        </div>
    </div>

    <div id="admin-p" class="page">
        <h3>Admin Controls</h3>
        <div style="background:#fff; color:#111; padding:15px; border-radius:8px;">
            <h4>Upload New Sketch</h4>
            <input type="text" id="p-name" placeholder="Title">
            <input type="number" id="p-price" placeholder="Price (‚Çπ)">
            <input type="file" id="p-file" accept="image/*">
            <button class="btn btn-p" onclick="upload()">Publish Product</button>
            <hr>
            <h4>Manage Sketches</h4>
            <div id="manage-list"></div>
        </div>
    </div>

    <nav class="nav">
        <div class="nav-link active" onclick="nav('home')">üè†<br>Home</div>
        <div class="nav-link" onclick="nav('rishi')">ü§ñ<br>Rishi</div>
        <div class="nav-link" onclick="nav('wallet')">üí≥<br>Wallet</div>
        <div class="nav-link" onclick="nav('you')">üë§<br>You</div>
        <div class="nav-item" onclick="adminAccess()" style="cursor:pointer; text-align:center; font-size:11px; color:#ccc;">‚öôÔ∏è<br>Admin</div>
    </nav>
</div>

<script>
    // --- DATABASE CONFIG ---
    let products = JSON.parse(localStorage.getItem('db_p')) || [];
    let orders = JSON.parse(localStorage.getItem('db_o')) || [];
    let adminPass = localStorage.getItem('db_pass') || "SRP786";
    let currentUser = localStorage.getItem('active_session');

    // Check Persistent Session
    if(currentUser) {
        document.getElementById('auth-gate').style.display = 'none';
        document.getElementById('main-app').style.display = 'block';
        document.getElementById('user-info').innerText = currentUser;
        render();
    }

    // --- SECURE LOGIN ---
    function login() {
        const e = document.getElementById('a-email').value;
        const p = document.getElementById('a-pass').value;
        if(e.includes('@') && p.length > 5) {
            localStorage.setItem('active_session', e);
            location.reload();
        } else { alert("Invalid Credentials."); }
    }

    function logout() { localStorage.removeItem('active_session'); location.reload(); }

    // --- NAVIGATION (Fixed: No Alerts) ---
    function nav(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
        document.getElementById(id + '-p').classList.add('active-page');
        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
        if(event.currentTarget.classList) event.currentTarget.classList.add('active');
        if(id === 'home') render();
        if(id === 'admin') renderManage();
    }

    function adminAccess() {
        if(prompt("Admin Password:") === adminPass) nav('admin');
    }

    // --- ADMIN: UPLOAD & MANAGE (Fixed: No Links Needed) ---
    function upload() {
        const file = document.getElementById('p-file').files[0];
        const reader = new FileReader();
        reader.onloadend = () => {
            products.push({
                id: Date.now(),
                title: document.getElementById('p-name').value,
                price: document.getElementById('p-price').value,
                img: reader.result,
                inStock: true
            });
            localStorage.setItem('db_p', JSON.stringify(products));
            alert("Success!");
            render();
        };
        if(file) reader.readAsDataURL(file);
    }

    function renderManage() {
        const list = document.getElementById('manage-list');
        list.innerHTML = products.map((p, i) => `
            <div style="border-bottom:1px solid #ddd; padding:10px; display:flex; justify-content:space-between;">
                <span>${p.title}</span>
                <div>
                    <button onclick="toggleStock(${i})">${p.inStock ? 'OOS' : 'Stock'}</button>
                    <button onclick="del(${i})" style="color:red">Delete</button>
                </div>
            </div>
        `).join('');
    }

    function toggleStock(i) { products[i].inStock = !products[i].inStock; save(); renderManage(); }
    function del(i) { products.splice(i,1); save(); renderManage(); }
    function save() { localStorage.setItem('db_p', JSON.stringify(products)); }

    // --- STORE RENDER ---
    function render() {
        const grid = document.getElementById('product-list');
        grid.innerHTML = products.map((p, i) => `
            <div class="item ${p.inStock ? '' : 'oos'}">
                ${p.inStock ? '' : '<div class="oos-tag">OUT OF STOCK</div>'}
                <img src="${p.img}">
                <div style="font-weight:bold; margin-top:5px;">${p.title}</div>
                <div style="color:red;">‚Çπ${p.price}</div>
                <button class="btn btn-p" ${p.inStock ? '' : 'disabled'} onclick="buy(${i})">Buy Now</button>
            </div>
        `).join('');
    }

    function buy(i) {
        const upi = "subhashrajpurohit406@okaxis";
        const amt = products[i].price;
        const qr = `https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=upi://pay?pa=${upi}&am=${amt}&cu=INR`;
        document.body.innerHTML += `<div id="p-over" style="position:fixed;inset:0;background:#fff;z-index:10000;padding:20px;color:#111;text-align:center;">
            <h2>Scan & Pay ‚Çπ${amt}</h2>
            <img src="${qr}"><br><br>
            <button class="btn btn-p" onclick="location.reload()">Paid: Confirm</button>
        </div>`;
    }

    // --- RISHI AI (Fixed: Real Responses) ---
    function askRishi() {
        const q = document.getElementById('r-input').value.toLowerCase();
        const chat = document.getElementById('r-chat');
        chat.innerHTML += `<div class="msg u-msg">${q}</div>`;
        
        let ans = "I am Rishi. Ask me about sketch prices or how to pay via UPI.";
        if(q.includes("price")) ans = "Sketches vary from ‚Çπ500 to ‚Çπ5000. Check the Home tab!";
        if(q.includes("how to buy")) ans = "Click 'Buy Now' on any sketch and scan the QR code to pay.";
        if(q.includes("about")) ans = "SRP STUDIO is owned by Subhash Rajpurohit, specializing in charcoal art.";
        
        setTimeout(() => {
            chat.innerHTML += `<div class="msg r-msg"><b>Rishi:</b> ${ans}</div>`;
            chat.scrollTop = chat.scrollHeight;
        }, 500);
        document.getElementById('r-input').value = "";
    }

    function addMoney() {
        alert("Wallet Top-up: Scan the UPI QR on next screen to add balance.");
    }
</script>
</body>
</html>

