<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SRP SKETCH | Official</title>
    <style>
        :root { --amz-orange: #febd69; --amz-dark: #232f3e; --bg: #131921; --card: #ffffff; --text: #111; }
        body { margin: 0; font-family: Arial, sans-serif; background: var(--bg); color: #fff; padding-bottom: 80px; }
        
        /* Strict Gating */
        #main-app { display: none; }
        .overlay { position: fixed; inset: 0; background: #fff; color: #111; z-index: 5000; padding: 20px; overflow-y: auto; }
        .active-overlay { display: block !important; }

        /* Amazon UI Components */
        header { background: #232f3e; padding: 15px; display: flex; justify-content: space-between; position: sticky; top:0; z-index: 1000; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px; }
        .page-section { display: none; padding: 10px; }
        .active-section { display: block; }

        /* Cards & Styling */
        .product-card { background: var(--card); color: var(--text); padding: 10px; border-radius: 4px; display: flex; flex-direction: column; position: relative; }
        .out-of-stock { opacity: 0.5; grayscale: 100%; }
        .stock-tag { position: absolute; top: 5px; background: red; color: white; padding: 2px 5px; font-size: 10px; border-radius: 3px; }
        .product-card img { width: 100%; height: 150px; object-fit: cover; }
        
        /* Buttons */
        .btn { width: 100%; padding: 10px; border-radius: 20px; border: none; font-weight: bold; cursor: pointer; margin-top: 5px; }
        .btn-yellow { background: #ffd814; }
        .btn-orange { background: #ffa41c; }
        input, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }

        /* Nav */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: #232f3e; display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid #3a4553; }
        .nav-item { text-align: center; font-size: 11px; color: #ccc; cursor: pointer; }
        .nav-item.active-nav { color: var(--amz-orange); }

        /* Rishi Chat */
        #chat-logs { height: 300px; overflow-y: auto; background: #1a1a1a; padding: 10px; border-radius: 5px; margin-bottom: 10px; }
        .msg { margin-bottom: 10px; font-size: 14px; }
    </style>
</head>
<body>

<div id="login-screen" class="overlay active-overlay">
    <center><h1 style="color:#232f3e">SRP SKETCH</h1></center>
    <div style="border:1px solid #ddd; padding:20px; border-radius:8px; margin-top:20px;">
        <h2>Login</h2>
        <input type="email" id="log-email" placeholder="Email Address">
        <input type="password" id="log-pass" placeholder="Password">
        <button class="btn btn-orange" onclick="validateLogin()">Enter Site</button>
        <p style="font-size:12px; color:#666; text-align:center;">Email/Pass required to browse</p>
    </div>
</div>

<div id="main-app">
    <header>
        <div style="color:var(--amz-orange); font-weight:bold; font-size:20px;">SRP SKETCH</div>
    </header>

    <div id="home-sec" class="page-section active-section">
        <div class="grid" id="product-grid"></div>
    </div>

    <div id="rishi-sec" class="page-section">
        <h3>ü§ñ Rishi AI Shopping Assistant</h3>
        <div id="chat-logs">
            <div class="msg" style="color:var(--amz-orange)"><b>Rishi:</b> Hello! I can help you find sketches, check prices, or guide you through payments. What are you looking for today?</div>
        </div>
        <div style="display:flex; gap:5px;">
            <input type="text" id="rishi-input" placeholder="Ask Rishi anything..." style="margin:0;">
            <button class="btn btn-orange" style="width:70px; margin:0;" onclick="askRishi()">Ask</button>
        </div>
    </div>

    <div id="wallet-sec" class="page-section">
        <h3>My Wallet</h3>
        <div style="background:#232f3e; padding:30px; border-radius:10px; text-align:center;">
            <h1>‚Çπ0.00</h1>
            <button class="btn btn-yellow" style="width:auto; padding:10px 30px;">Add Money</button>
        </div>
    </div>

    <div id="you-sec" class="page-section">
        <h3>My Account</h3>
        <div style="background:#fff; color:#111; border-radius:8px; padding:5px;">
            <div style="padding:15px; border-bottom:1px solid #eee;" onclick="alert('No orders yet')">üì¶ My Orders</div>
            <div style="padding:15px; border-bottom:1px solid #eee;">üìú User Agreement</div>
            <div style="padding:15px; border-bottom:1px solid #eee;">üõ°Ô∏è Privacy Policy</div>
            <div style="padding:15px; color:red;" onclick="location.reload()">üö™ Logout</div>
        </div>
    </div>

    <div id="admin-sec" class="page-section">
        <div style="background:#fff; color:#111; padding:15px; border-radius:8px;">
            <h3>Admin Panel</h3>
            <button class="btn btn-yellow" onclick="setAdminTab('add')">Add New</button>
            <button class="btn btn-yellow" onclick="setAdminTab('manage')">Manage Sketches</button>
            <button class="btn btn-yellow" onclick="setAdminTab('orders')">Orders</button>
            <button class="btn btn-yellow" onclick="setAdminTab('pass')">Security</button>
            <hr>

            <div id="adm-add">
                <input type="text" id="p-title" placeholder="Sketch Title">
                <input type="number" id="p-price" placeholder="Price">
                <input type="file" id="p-file" accept="image/*">
                <button class="btn btn-orange" onclick="uploadSketch()">Publish</button>
            </div>

            <div id="adm-manage" style="display:none;">
                <h4>Edit / Delete Sketches</h4>
                <div id="manage-list"></div>
            </div>

            <div id="adm-orders" style="display:none;">
                <h4>Customer Orders</h4>
                <div id="order-logs"></div>
            </div>

            <div id="adm-pass" style="display:none;">
                <input type="text" id="new-pwd" placeholder="New Admin Password">
                <button class="btn btn-orange" onclick="updateAdminPwd()">Update</button>
            </div>
        </div>
    </div>

    <nav class="bottom-nav">
        <div class="nav-item active-nav" onclick="navTo('home')">üè†<br>Home</div>
        <div class="nav-item" onclick="navTo('rishi')">ü§ñ<br>Rishi</div>
        <div class="nav-item" onclick="navTo('wallet')">üí≥<br>Wallet</div>
        <div class="nav-item" onclick="navTo('you')">üë§<br>You</div>
        <div class="nav-item" onclick="adminAuth()">‚öôÔ∏è<br>Admin</div>
    </nav>
</div>

<div id="pay-overlay" class="overlay">
    <h2>Secure Checkout</h2>
    <div id="buy-summary" style="font-weight:bold; margin-bottom:10px;"></div>
    <input type="text" id="c-name" placeholder="Name">
    <input type="text" id="c-phone" placeholder="WhatsApp Number">
    <textarea id="c-addr" placeholder="Address"></textarea>
    <p style="color:green"><b>Payment Method: UPI QR (Required)</b></p>
    <div id="upi-qr" style="text-align:center;"></div>
    <button class="btn btn-orange" onclick="confirmPay()">I have Paid via UPI</button>
    <button class="btn" onclick="closePay()" style="background:#eee;">Cancel</button>
</div>

<script>
    let products = JSON.parse(localStorage.getItem('srp_products')) || [];
    let orders = JSON.parse(localStorage.getItem('srp_orders')) || [];
    let adminPass = localStorage.getItem('srp_admin_pwd') || "SRP786";
    let activeItem = null;

    // --- GATEKEEPER ---
    function validateLogin() {
        let e = document.getElementById('log-email').value;
        let p = document.getElementById('log-pass').value;
        if(e.includes('@') && p.length > 3) {
            document.getElementById('login-screen').classList.remove('active-overlay');
            document.getElementById('main-app').style.display = 'block';
            renderProducts();
        } else {
            alert("Please enter valid Email and Password to enter.");
        }
    }

    // --- NAVIGATION ---
    function navTo(id) {
        document.querySelectorAll('.page-section').forEach(s => s.classList.remove('active-section'));
        document.getElementById(id + '-sec').classList.add('active-section');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active-nav'));
        event.currentTarget.classList.add('active-nav');
    }

    // --- ADMIN LOGIC ---
    function adminAuth() {
        if(prompt("Admin Password:") === adminPass) navTo('admin');
    }

    function setAdminTab(t) {
        document.getElementById('adm-add').style.display = t==='add'?'block':'none';
        document.getElementById('adm-manage').style.display = t==='manage'?'block':'none';
        document.getElementById('adm-orders').style.display = t==='orders'?'block':'none';
        document.getElementById('adm-pass').style.display = t==='pass'?'block':'none';
        if(t==='manage') renderManageList();
        if(t==='orders') renderOrderLogs();
    }

    function uploadSketch() {
        const file = document.getElementById('p-file').files[0];
        const reader = new FileReader();
        reader.onloadend = () => {
            products.push({
                id: Date.now(),
                title: document.getElementById('p-title').value,
                price: document.getElementById('p-price').value,
                img: reader.result,
                inStock: true
            });
            localStorage.setItem('srp_products', JSON.stringify(products));
            alert("Sketch Live!"); renderProducts();
        };
        if(file) reader.readAsDataURL(file);
    }

    function renderManageList() {
        const box = document.getElementById('manage-list');
        box.innerHTML = products.map((p, i) => `
            <div style="border-bottom:1px solid #ddd; padding:10px; color:#111;">
                <b>${p.title}</b> (‚Çπ${p.price}) <br>
                <button onclick="toggleStock(${i})">${p.inStock?'Mark Out of Stock':'Mark Available'}</button>
                <button onclick="deleteSketch(${i})" style="color:red">Delete</button>
            </div>
        `).join('');
    }

    function toggleStock(i) { products[i].inStock = !products[i].inStock; saveAndRefresh(); }
    function deleteSketch(i) { if(confirm("Delete?")) { products.splice(i, 1); saveAndRefresh(); } }
    function saveAndRefresh() { 
        localStorage.setItem('srp_products', JSON.stringify(products)); 
        renderManageList(); renderProducts(); 
    }

    // --- STORE ---
    function renderProducts() {
        const grid = document.getElementById('product-grid');
        grid.innerHTML = products.map((p, i) => `
            <div class="product-card ${p.inStock?'':'out-of-stock'}">
                ${p.inStock?'':'<div class="stock-tag">OUT OF STOCK</div>'}
                <img src="${p.img}">
                <div style="margin-top:5px; font-weight:bold;">${p.title}</div>
                <div style="color:red; font-weight:bold;">‚Çπ${p.price}</div>
                <button class="btn btn-orange" ${p.inStock?'':'disabled'} onclick="initBuy(${i})">Buy Now</button>
            </div>
        `).join('');
    }

    function initBuy(i) {
        activeItem = products[i];
        document.getElementById('buy-summary').innerText = `Purchase: ${activeItem.title} (‚Çπ${activeItem.price})`;
        const upi = "subhashrajpurohit406@okaxis";
        const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=upi://pay?pa=${upi}&am=${activeItem.price}&cu=INR`;
        document.getElementById('upi-qr').innerHTML = `<img src="${qrUrl}"><br><small>Scan to Pay ‚Çπ${activeItem.price}</small>`;
        document.getElementById('pay-overlay').classList.add('active-overlay');
    }

    function confirmPay() {
        orders.push({
            item: activeItem.title,
            user: document.getElementById('c-name').value,
            phone: document.getElementById('c-phone').value,
            addr: document.getElementById('c-addr').value,
            time: new Date().toLocaleString()
        });
        localStorage.setItem('srp_orders', JSON.stringify(orders));
        alert("Order Received via UPI!");
        closePay();
    }

    function closePay() { document.getElementById('pay-overlay').classList.remove('active-overlay'); }

    // --- RISHI AI ---
    function askRishi() {
        let q = document.getElementById('rishi-input').value.toLowerCase();
        let logs = document.getElementById('chat-logs');
        logs.innerHTML += `<div class="msg" style="text-align:right;"><b>You:</b> ${q}</div>`;
        
        let reply = "I'm sorry, I didn't quite catch that. You can ask me about sketch prices or how to pay.";
        if(q.includes("price") || q.includes("cost")) reply = "Our sketches start from the price listed under each image. You can pay via UPI QR code.";
        if(q.includes("payment") || q.includes("pay")) reply = "We only accept UPI payments. Once you click 'Buy Now', a QR code will appear.";
        if(q.includes("stock")) reply = "If a sketch shows 'Out of Stock', it is currently unavailable for purchase.";
        
        setTimeout(() => {
            logs.innerHTML += `<div class="msg" style="color:var(--amz-orange)"><b>Rishi:</b> ${reply}</div>`;
            logs.scrollTop = logs.scrollHeight;
        }, 500);
        document.getElementById('rishi-input').value = "";
    }

    function renderOrderLogs() {
        document.getElementById('order-logs').innerHTML = orders.map(o => `
            <div style="background:#eee; padding:10px; margin-bottom:5px; border-radius:5px; font-size:12px; color:#111;">
                <b>${o.item}</b> by ${o.user} (${o.phone})<br>Addr: ${o.addr}
            </div>
        `).reverse().join('');
    }
</script>
</body>
</html>
